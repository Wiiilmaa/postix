# -*- coding: utf-8 -*-
# Generated by Django 1.9.2 on 2016-12-28 12:05
from __future__ import unicode_literals

from django.db import migrations, models


def fix_negative_integers(apps, schema_editor):
    TransactionPositionItem = apps.get_model("core", "TransactionPositionItem")

    for tpi in TransactionPositionItem.objects.select_related("position").filter(
        position__type="reverse"
    ):
        revd = TransactionPositionItem.objects.get(
            position=tpi.position.reverses, item_id=tpi.item_id
        )
        tpi.amount = -1 * revd.amount
        tpi.save()


class Migration(migrations.Migration):

    dependencies = [("core", "0035_preorderposition_last_transaction")]

    operations = [
        migrations.AlterField(
            model_name="transactionpositionitem",
            name="amount",
            field=models.IntegerField(),
        ),
        migrations.RunPython(fix_negative_integers, migrations.RunPython.noop),
    ]
